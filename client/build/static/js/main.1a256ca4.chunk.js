(this["webpackJsonpxrtl-spa"]=this["webpackJsonpxrtl-spa"]||[]).push([[0],{15:function(e,t,o){e.exports={chatContainer:"Chat_chatContainer__3x3id",chatMain:"Chat_chatMain__3lU48",msgForm:"Chat_msgForm__2chd7",chatHandler:"Chat_chatHandler__2biyA",openChat:"Chat_openChat__3JExo",closeChat:"Chat_closeChat__o5avG",buttonBlink:"Chat_buttonBlink__3_8g7"}},23:function(e,t,o){e.exports={consoleContainer:"Console_consoleContainer__3jsOc",consoleMain:"Console_consoleMain__Ul5-P",consoleHandler:"Console_consoleHandler__3EZu5",openConsole:"Console_openConsole__2hPdY",closeConsole:"Console_closeConsole__S0_B3"}},24:function(e,t,o){e.exports={window:"Window_window__2yRZ4",windowHeader:"Window_windowHeader__2nws7",windowHeaderIcon:"Window_windowHeaderIcon__2zOvE",windowFooter:"Window_windowFooter__2MzCX"}},28:function(e,t,o){e.exports={rotaryCtrl:"RotaryCtrl_rotaryCtrl__1GrAd",CtrlLeft:"RotaryCtrl_CtrlLeft__1muK7",CtrlRight:"RotaryCtrl_CtrlRight__tS41h"}},35:function(e,t,o){},38:function(e,t,o){e.exports={navbar:"NavBar_navbar__3MCb5",navMenu:"NavBar_navMenu__240TL"}},40:function(e,t,o){e.exports={webcamDiv:"Webcam_webcamDiv__2jPVK"}},86:function(e,t){},88:function(e,t){},96:function(e,t,o){},97:function(e,t,o){"use strict";o.r(t);var s=o(3),n=o.n(s),a=o(10),c=o.n(a),r=o(38),i=o.n(r),l=o(56),d=o(33),j=o(34),h=o(57),b=o(11),m=o(2);const p=n.a.createContext();function u(){return Object(s.useContext)(p)}function g({children:e}){const[t,o]=Object(s.useState)(!0),[n,a]=Object(s.useState)(!0),[c,r]=Object(s.useState)(!1),[i,l]=Object(s.useState)(new Set),[d,j]=Object(s.useState)(new Set),[h,b]=Object(s.useState)([]),[u,g]=Object(s.useState)(!0);return Object(m.jsx)(p.Provider,{value:{autoRotate:t,toggleAutoRotate:()=>{o(!t)},showVirtualLayer:n,toggleShowVirtualLayer:()=>{a(!n)},selectedComps:i,toggleSelectedComp:e=>{i.has(e)?l((t=>new Set([...t].filter((t=>t!==e))))):l((t=>new Set(t.add(e))))},logs:h,addLog:e=>{b((t=>[e,...t]))},busyComps:d,addBusyComp:e=>{d.has(e)||j((t=>new Set(t.add(e))))},removeBusyComp:e=>{d.has(e)&&j((t=>new Set([...t].filter((t=>t!==e)))))},showTags:u,toggleShowTags:()=>{g(!u)},showWebcam:c,toggleShowWebcam:()=>{r(!c)}},children:e})}const{Manager:x}=o(98),O="http://192.168.1.42:7000",C=new x(O,{autoConnect:!1}).socket("/"),f=n.a.createContext();function w(){return Object(s.useContext)(f)}function v({children:e}){const[t,o]=Object(s.useState)(!1),n=u();Object(s.useEffect)((()=>{C.on("connect",(e=>{o(!0),n.addLog("Server : Client connected to "+O)})),C.on("disconnect",(e=>{o(!1),n.addLog("Server : Client disconnect.")})),C.on("status",(e=>{e.status.busy?n.addBusyComp(e.componentId):n.removeBusyComp(e.componentId)}))}));return Object(m.jsx)(f.Provider,{value:{socket:C,connected:t,toggleConnection:()=>{console.log(t),t?(console.log(C.close()),o(!1),n.addLog("Client disconnected by choice.")):(console.log(C.connect()),o(!0),n.addLog("Client connected to "+O+" by choice."))}},children:e})}var _=()=>{const e=u(),t=w();let o="";t.connected&&(o="white");let s="";e.autoRotate&&(s="white");let n="";e.showTags&&(n="white");let a="";return e.showWebcam&&(a="white"),Object(m.jsxs)("div",{id:"navbar",className:i.a.navbar,children:[Object(m.jsx)("h1",{children:"XR Remote Lab"}),Object(m.jsx)("div",{className:i.a.navMenu,children:Object(m.jsxs)("ul",{children:[Object(m.jsx)("li",{onClick:t.toggleConnection,children:Object(m.jsx)(d.b,{size:29,color:o})}),Object(m.jsx)("li",{onClick:e.toggleShowVirtualLayer,children:Object(m.jsx)(j.a,{size:26})}),Object(m.jsx)("li",{children:Object(m.jsx)(l.a,{size:29})}),Object(m.jsx)("li",{onClick:e.toggleAutoRotate,children:Object(m.jsx)(b.c,{size:26,color:s})}),Object(m.jsx)("li",{onClick:e.toggleShowTags,children:Object(m.jsx)(h.a,{size:25,color:n})}),Object(m.jsx)("li",{onClick:e.toggleShowWebcam,children:Object(m.jsx)(j.b,{size:26,color:a})})]})})]})},y=o(58),S=o(23),M=o.n(S);var k=e=>{const[t,o]=Object(s.useState)(!1),[n,a]=Object(s.useState)(""),c=u();return Object(m.jsxs)("div",{className:M.a.consoleContainer+" "+n,children:[Object(m.jsx)("div",{className:M.a.consoleMain,children:c.logs.map(((e,t)=>Object(m.jsxs)("span",{children:[":",e,Object(m.jsx)("br",{})]},t)))}),Object(m.jsx)("div",{className:M.a.consoleHandler,children:Object(m.jsx)("span",{children:Object(m.jsx)(y.a,{size:35,onClick:()=>{a(t?M.a.closeConsole:M.a.openConsole),o(!t)}})})})]})},I=o(15),D=o.n(I);var N=e=>{const[t,o]=Object(s.useState)(""),[n,a]=Object(s.useState)(!1),[c,r]=Object(s.useState)(""),[i,l]=Object(s.useState)([]),j=w();Object(s.useEffect)((()=>{j.socket.on("message",(e=>{l([...i,e])}))}),[j,i]);return Object(m.jsxs)("div",{className:D.a.chatContainer+" "+c,children:[Object(m.jsx)("div",{className:D.a.chatMain,children:i.map(((e,t)=>Object(m.jsxs)("b",{children:[e.userName,": ",Object(m.jsx)("span",{children:e.message}),Object(m.jsx)("br",{})]},t)))}),Object(m.jsxs)("form",{className:D.a.msgForm,onSubmit:e=>{e.preventDefault(),console.log(t),j.socket.emit("message",{userName:"user",message:t}),o("")},children:[Object(m.jsx)("input",{type:"text",name:"message",placeholder:"Type Message here",value:t,onChange:e=>{o(e.target.value)},required:!0}),Object(m.jsx)("button",{type:"submit",children:Object(m.jsx)(b.d,{size:25})})]}),Object(m.jsx)("div",{className:D.a.chatHandler+" "+c,children:Object(m.jsx)("span",{children:Object(m.jsx)(d.a,{size:35,onClick:()=>{r(n?D.a.closeChat:D.a.openChat),a(!n)}})})})]})},L=o(4),P=o(102),R=o(103),B=o(101),z=(o(100),o(99));var T=e=>Object(m.jsxs)(z.a,{position:e.position,style:{color:"white",width:"200px",height:"30px"},zIndexRange:[0,10],children:[Object(m.jsx)("div",{style:{height:"150px",width:"0px","border-left":"2px solid white",float:"left"}}),Object(m.jsxs)("div",{style:{"margin-left":"12px"},children:[Object(m.jsx)("span",{children:Object(m.jsx)("b",{children:e.title})}),Object(m.jsx)("br",{}),e.description,Object(m.jsx)("br",{}),e.status]})]});function W({...e}){const t=Object(s.useRef)(),{nodes:o,materials:n}=Object(B.a)("/model/DL4Y_export1.glb");return Object(m.jsxs)("group",{ref:t,...e,dispose:null,children:[Object(m.jsxs)("group",{position:[-.89,.67,.8],onPointerDown:t=>{t.stopPropagation(),e.toggleSelect("KM100_2")},children:[e.showTags&&Object(m.jsx)(T,{position:[0,1,0],title:"Reference Mirror",description:"KM100 Double Rotary Control"}),Object(m.jsx)("mesh",{geometry:o.SideMirrorMesh.geometry,material:o.SideMirrorMesh.material,children:e.selected.has("KM100_2")?Object(m.jsx)("meshStandardMaterial",{color:"#00ff00",transparent:!0,opacity:.7}):Object(m.jsx)("meshBasicMaterial",{color:"#222222",opacity:1})}),Object(m.jsx)("mesh",{geometry:o.SideMirrorMesh_1.geometry,material:o.SideMirrorMesh_1.material}),Object(m.jsx)("mesh",{geometry:o.SideMirrorMesh_2.geometry,material:n.Mirror})]}),Object(m.jsxs)("group",{position:[-.89,.86,-1.12],onPointerDown:t=>{t.stopPropagation(),e.toggleSelect("screen")},children:[e.showTags&&Object(m.jsx)(T,{position:[0,1.4,0],title:"Screen",description:""}),Object(m.jsx)("mesh",{geometry:o.PlaneMesh.geometry,material:n.WhiteParts,children:e.selected.has("screen")?Object(m.jsx)("meshStandardMaterial",{color:"#00ff00",transparent:!0,opacity:.7}):Object(m.jsx)("meshBasicMaterial",{color:"#eeeeee",opacity:1})}),Object(m.jsx)("mesh",{geometry:o.PlaneMesh_1.geometry,material:o.PlaneMesh_1.material})]}),Object(m.jsxs)("group",{position:[1.25,.67,.88],onPointerDown:t=>{t.stopPropagation(),e.toggleSelect("Laser")},children:[e.showTags&&Object(m.jsx)(T,{position:[0,1,0],title:"Laser",description:"green Laserpointer"}),Object(m.jsx)("mesh",{geometry:o.LaserMesh.geometry,material:o.LaserMesh.material,children:e.selected.has("Laser")?Object(m.jsx)("meshStandardMaterial",{color:"#00ff00",transparent:!0,opacity:.7}):Object(m.jsx)("meshBasicMaterial",{color:"#222222",opacity:1})}),Object(m.jsx)("mesh",{geometry:o.LaserMesh_1.geometry,material:o.LaserMesh_1.material})]}),Object(m.jsxs)("group",{position:[-.92,.49,-.14],onPointerDown:t=>{t.stopPropagation(),e.toggleSelect("iris")},children:[e.showTags&&Object(m.jsx)(T,{position:[0,1.4,0],title:"Iris",description:"Controllable 15mm Iris Diaphragm"}),Object(m.jsx)("mesh",{geometry:o.ID15Mesh.geometry,material:o.ID15Mesh.material,children:e.selected.has("iris")?Object(m.jsx)("meshStandardMaterial",{color:"#00ff00",transparent:!0,opacity:.7}):Object(m.jsx)("meshBasicMaterial",{color:"#222222",opacity:1})}),Object(m.jsx)("mesh",{geometry:o.ID15Mesh_1.geometry,material:o.ID15Mesh_1.material})]}),Object(m.jsx)("mesh",{geometry:o.Base.geometry,material:o.Base.material})]})}B.a.preload("/model/MI_1312.glb"),B.a.preload("/model/DL4Y_export1.glb");var H=()=>{const e=u();return e.showVirtualLayer?Object(m.jsx)(L.a,{style:{position:"absolute",background:"linear-gradient(Teal, Black)",width:"100%",height:"100%"},colorManagement:!0,softShadows:!0,camera:{position:[0,3,5],fov:40},children:Object(m.jsxs)(s.Suspense,{fallback:null,children:[Object(m.jsx)(P.a,{preset:"warehouse"}),Object(m.jsx)(R.a,{autoRotate:e.autoRotate}),Object(m.jsx)(W,{toggleSelect:e.toggleSelectedComp,selected:e.selectedComps,showTags:e.showTags})]})}):Object(m.jsx)(m.Fragment,{})},E=o(61),F=o.n(E),U=o(24),K=o.n(U),A=o(62);var V=e=>Object(m.jsx)(F.a,{handle:".draggableHandler",children:Object(m.jsxs)("div",{className:K.a.window,style:{top:e.top+"px",left:e.left+"px"},children:[Object(m.jsxs)("div",{className:K.a.windowHeader,children:[Object(m.jsx)("span",{className:"draggableHandler",style:{display:"block",width:"calc(100% - 50px)",cursor:"move",float:"left"},children:e.header}),Object(m.jsx)("div",{className:K.a.windowHeaderIcon,onClick:e.onClose,children:Object(m.jsx)(A.a,{size:20})})]}),Object(m.jsx)("div",{className:K.a.windowContent,style:{height:e.height,width:e.width,background:"url("+e.background+")"},children:e.children}),void 0!==e.footer&&Object(m.jsx)("div",{className:K.a.windowFooter,children:e.footer})]})}),J=o(35),Y=o.n(J);var G=e=>{const[t,o]=Object(s.useState)(e.sliderPos),n=u(),a=w();Object(s.useEffect)((()=>{a.socket.on("status",(t=>{t.component===e.component&&o(t.status[e.control])}))}),[a.socket]);return Object(m.jsx)("form",{className:Y.a.sliderCtrl,style:{top:e.top+"px",left:e.left+"px"},children:Object(m.jsxs)("div",{className:Y.a.sliderCtrl,children:[Object(m.jsx)("span",{children:t}),Object(m.jsx)("input",{type:"range",min:"0",max:"100",value:t,className:Y.a.sliderCtrl,onChange:e=>{e.preventDefault(),o(e.target.value)},onMouseUp:s=>{s.preventDefault(),o(s.target.value),console.log("Sending Command "+s.target.value),a.socket.emit("command",{userId:"user123",componentId:e.component,command:{position:t}}),n.addLog("User set position on "+e.component+" to "+t)}})]})})};var X=e=>{const t=u();return Object(m.jsx)(V,{header:e.title+" ("+e.id+")",top:e.top,left:e.left,height:"240px",width:"250px",onClose:()=>{t.toggleSelectedComp(e.id)},children:Object(m.jsx)(G,{sliderPos:e.sliderPos,component:e.id,top:"50",left:"50"})})},Z=o(28),q=o.n(Z);var Q=e=>{const[t,o]=Object(s.useState)(e.rotation),[n,a]=Object(s.useState)(0),c=u(),r=w();Object(s.useEffect)((()=>{r.socket.on("status",(t=>{t.componentId===e.component&&o(t.status[e.control])}))}),[r.socket]);return Object(m.jsxs)("form",{className:q.a.rotaryCtrl,style:{top:e.top+"px",left:e.left+"px"},children:[Object(m.jsxs)("div",{className:q.a.rotaryCtrl,children:[Object(m.jsx)("span",{children:t}),Object(m.jsx)("input",{type:"number",min:"0",max:"100",value:n,onChange:e=>{a(e.target.value)}})]}),Object(m.jsx)("button",{onClick:t=>{t.preventDefault(),r.socket.emit("command",{userId:"user123",componentId:e.component,controlId:e.control,command:{steps:-1*n}}),c.addLog("User initiated CCW rotation on "+e.component+" / "+e.control+" by "+n+" steps.")},className:q.a.CtrlLeft,disabled:c.busyComps.has(e.component),children:Object(m.jsx)(b.a,{size:28})}),Object(m.jsx)("button",{onClick:t=>{t.preventDefault(),r.socket.emit("command",{userId:"user123",componentId:e.component,controlId:e.control,command:{steps:n}}),c.addLog("User initiated CW rotation on "+e.component+" / "+e.control+" by "+n+" steps.")},className:q.a.CtrlRight,disabled:c.busyComps.has(e.component),children:Object(m.jsx)(b.b,{size:28})})]})},$=o.p+"static/media/km100_outline.5cffd463.png";var ee=e=>{const[t,o]=Object(s.useState)(e.footer),n=u(),a=e=>{o(e)};return Object(m.jsxs)(V,{header:e.title+" ("+e.id+")",footer:t,top:e.top,left:e.left,height:"240px",width:"250px",background:$,onClose:()=>{n.toggleSelectedComp(e.id)},children:[Object(m.jsx)(Q,{rotation:e.rotationTop,component:e.id,control:"top",newStatus:a,top:"20",left:"160"}),Object(m.jsx)(Q,{rotation:e.rotationBottom,component:e.id,control:"bottom",newStatus:a,top:"50",left:"160"})]})};var te=e=>{const t=w(),o=u();return Object(s.useEffect)((()=>{t.socket.on("pic",(function(e){for(var t=new Uint8Array(e.buffer),o="",s=0;s<t.length;s++)o+=String.fromCharCode(t[s]);var n=window.btoa(o),a=new Image;a.onload=function(){document.getElementById("ScreenCanvas").getContext("2d").drawImage(this,0,0)},a.src="data:image/jpg;base64,"+n}))}),[t.socket]),Object(m.jsx)(V,{header:e.title+" ("+e.id+")",top:e.top,left:e.left,width:"800px",height:"600px",onClose:()=>{o.toggleSelectedComp(e.id)},children:Object(m.jsx)("canvas",{id:"ScreenCanvas",width:"800px",height:"600px"})})};var oe=e=>Object(m.jsxs)("div",{children:[e.selected.has("KM100_2")&&Object(m.jsx)(ee,{title:"Mirror",id:"KM100_2",rotationTop:"0",rotationBottom:"0",footer:"Initializing...",top:"100",left:"100"}),e.selected.has("iris")&&Object(m.jsx)(X,{title:"Iris",id:"iris",sliderPos:"0",top:"150",left:"150"}),e.selected.has("screen")&&Object(m.jsx)(te,{title:"Camera",id:"screen",top:"100",left:"100"})]});var se=()=>{const e=u();return Object(m.jsx)(oe,{toggleSelect:e.toggleSelectedComp,selected:e.selectedComps})},ne=o(40),ae=o.n(ne),ce=o(78),re="";const ie=e=>{const t=Object(s.useRef)();return Object(s.useEffect)((()=>{e.peer.on("stream",(e=>{t.current.srcObject=e}))}),[]),Object(m.jsx)("video",{playsInline:!0,autoPlay:!0,ref:t})};var le=()=>{const e=w(),t=u(),[o,n]=Object(s.useState)([]),a=Object(s.useRef)(),c=Object(s.useRef)([]);return Object(s.useEffect)((()=>{const o={height:window.innerHeight/2,width:window.innerWidth/2};t.showWebcam&&navigator.mediaDevices.getUserMedia({video:o,audio:!0}).then((t=>{a.current.srcObject=t,e.socket.emit("roomID",(e=>{re=e})),e.socket.emit("client join room",re),e.socket.on("all users",(o=>{const s=[];o.forEach((o=>{const n=function(t,o,s){const n=new ce({initiator:!0,trickle:!1,stream:s});return n.on("signal",(s=>{e.socket.emit("sending signal",{userToSignal:t,callerID:o,signal:s})})),n}(o,e.socket.id,t);c.current.push({peerID:o,peer:n}),s.push(n)})),n(s)})),e.socket.on("user joined",(o=>{const s=function(t,o,s){const n=new ce({initiator:!1,trickle:!1,stream:s});return n.on("signal",(t=>{e.socket.emit("returning signal",{signal:t,callerID:o})})),n.signal(t),n}(o.signal,o.callerID,t);c.current.push({peerID:o.callerID,peer:s}),n((e=>[...e,s]))})),e.socket.on("receiving returned signal",(e=>{c.current.find((t=>t.peerID===e.id)).peer.signal(e.signal)}))}))}),[t.showWebcam]),t.showWebcam?Object(m.jsxs)("div",{className:ae.a.webcamDiv,children:[Object(m.jsx)("video",{className:ae.a.videoSt,muted:!0,ref:a,autoPlay:!0,playsInline:!0}),o.map(((e,t)=>Object(m.jsx)(ie,{peer:e},t)))]}):Object(m.jsx)(m.Fragment,{})};var de=()=>Object(m.jsx)(g,{children:Object(m.jsxs)(v,{children:[Object(m.jsx)(H,{}),Object(m.jsx)(se,{}),Object(m.jsx)(N,{}),Object(m.jsx)(le,{}),Object(m.jsx)(k,{}),Object(m.jsx)(_,{})]})});o(96);c.a.render(Object(m.jsx)(m.Fragment,{children:Object(m.jsx)(de,{})}),document.getElementById("root"))}},[[97,1,2]]]);
//# sourceMappingURL=main.1a256ca4.chunk.js.map
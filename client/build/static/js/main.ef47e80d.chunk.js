(this["webpackJsonpxrtl-spa"]=this["webpackJsonpxrtl-spa"]||[]).push([[0],{15:function(e,t,o){e.exports={chatContainer:"Chat_chatContainer__3x3id",chatMain:"Chat_chatMain__3lU48",msgForm:"Chat_msgForm__2chd7",chatHandler:"Chat_chatHandler__2biyA",openChat:"Chat_openChat__3JExo",closeChat:"Chat_closeChat__o5avG",buttonBlink:"Chat_buttonBlink__3_8g7"}},23:function(e,t,o){e.exports={consoleContainer:"Console_consoleContainer__3jsOc",consoleMain:"Console_consoleMain__Ul5-P",consoleHandler:"Console_consoleHandler__3EZu5",openConsole:"Console_openConsole__2hPdY",closeConsole:"Console_closeConsole__S0_B3"}},24:function(e,t,o){e.exports={window:"Window_window__2yRZ4",windowHeader:"Window_windowHeader__2nws7",windowHeaderIcon:"Window_windowHeaderIcon__2zOvE",windowFooter:"Window_windowFooter__2MzCX"}},28:function(e,t,o){e.exports={rotaryCtrl:"RotaryCtrl_rotaryCtrl__1GrAd",CtrlLeft:"RotaryCtrl_CtrlLeft__1muK7",CtrlRight:"RotaryCtrl_CtrlRight__tS41h"}},35:function(e,t,o){},38:function(e,t,o){e.exports={navbar:"NavBar_navbar__3MCb5",navMenu:"NavBar_navMenu__240TL"}},40:function(e,t,o){e.exports={webcamDiv:"Webcam_webcamDiv__2jPVK"}},78:function(e,t,o){},87:function(e,t){},89:function(e,t){},97:function(e,t,o){},98:function(e,t,o){"use strict";o.r(t);var s=o(3),n=o.n(s),a=o(10),c=o.n(a),r=o(38),i=o.n(r),l=o(56),d=o(33),j=o(34),m=o(57),h=o(11),b=o(2);const p=n.a.createContext();function u(){return Object(s.useContext)(p)}function g({children:e}){const[t,o]=Object(s.useState)(!0),[n,a]=Object(s.useState)(!0),[c,r]=Object(s.useState)(!1),[i,l]=Object(s.useState)(new Set),[d,j]=Object(s.useState)(new Set),[m,h]=Object(s.useState)([]),[u,g]=Object(s.useState)(!0);return Object(b.jsx)(p.Provider,{value:{autoRotate:t,toggleAutoRotate:()=>{o(!t)},showVirtualLayer:n,toggleShowVirtualLayer:()=>{a(!n)},selectedComps:i,toggleSelectedComp:e=>{i.has(e)?l((t=>new Set([...t].filter((t=>t!==e))))):l((t=>new Set(t.add(e))))},logs:m,addLog:e=>{h((t=>[e,...t]))},busyComps:d,addBusyComp:e=>{d.has(e)||j((t=>new Set(t.add(e))))},removeBusyComp:e=>{d.has(e)&&j((t=>new Set([...t].filter((t=>t!==e)))))},showTags:u,toggleShowTags:()=>{g(!u)},showWebcam:c,toggleShowWebcam:()=>{r(!c)}},children:e})}const{Manager:x}=o(99),O="http://192.168.1.42:7000",f=new x(O,{autoConnect:!1}).socket("/"),C=n.a.createContext();function w(){return Object(s.useContext)(C)}function _({children:e}){const[t,o]=Object(s.useState)(!1),n=u();Object(s.useEffect)((()=>{f.on("connect",(e=>{o(!0),n.addLog("Server : Client connected to "+O)})),f.on("disconnect",(e=>{o(!1),n.addLog("Server : Client disconnect.")})),f.on("status",(e=>{e.status.busy?n.addBusyComp(e.componentId):n.removeBusyComp(e.componentId)}))}));return Object(b.jsx)(C.Provider,{value:{socket:f,connected:t,toggleConnection:()=>{console.log(t),t?(console.log(f.close()),o(!1),n.addLog("Client disconnected by choice.")):(console.log(f.connect()),o(!0),n.addLog("Client connected to "+O+" by choice."))}},children:e})}var v=()=>{const e=u(),t=w();let o="";t.connected&&(o="white");let s="";e.autoRotate&&(s="white");let n="";e.showTags&&(n="white");let a="";return e.showWebcam&&(a="white"),Object(b.jsxs)("div",{id:"navbar",className:i.a.navbar,children:[Object(b.jsx)("h1",{children:"XR Remote Lab"}),Object(b.jsx)("div",{className:i.a.navMenu,children:Object(b.jsxs)("ul",{children:[Object(b.jsx)("li",{onClick:t.toggleConnection,children:Object(b.jsx)(d.b,{size:29,color:o})}),Object(b.jsx)("li",{onClick:e.toggleShowVirtualLayer,children:Object(b.jsx)(j.a,{size:26})}),Object(b.jsx)("li",{children:Object(b.jsx)(l.a,{size:29})}),Object(b.jsx)("li",{onClick:e.toggleAutoRotate,children:Object(b.jsx)(h.c,{size:26,color:s})}),Object(b.jsx)("li",{onClick:e.toggleShowTags,children:Object(b.jsx)(m.a,{size:25,color:n})}),Object(b.jsx)("li",{onClick:e.toggleShowWebcam,children:Object(b.jsx)(j.b,{size:26,color:a})})]})})]})},S=o(58),y=o(23),M=o.n(y);var k=e=>{const[t,o]=Object(s.useState)(!1),[n,a]=Object(s.useState)(""),c=u();return Object(b.jsxs)("div",{className:M.a.consoleContainer+" "+n,children:[Object(b.jsx)("div",{className:M.a.consoleMain,children:c.logs.map(((e,t)=>Object(b.jsxs)("span",{children:[":",e,Object(b.jsx)("br",{})]},t)))}),Object(b.jsx)("div",{className:M.a.consoleHandler,children:Object(b.jsx)("span",{children:Object(b.jsx)(S.a,{size:35,onClick:()=>{a(t?M.a.closeConsole:M.a.openConsole),o(!t)}})})})]})},I=o(15),D=o.n(I);var L=e=>{const[t,o]=Object(s.useState)(""),[n,a]=Object(s.useState)(!1),[c,r]=Object(s.useState)(""),[i,l]=Object(s.useState)([]),j=w();Object(s.useEffect)((()=>{j.socket.on("message",(e=>{l([...i,e])}))}),[j,i]);return Object(b.jsxs)("div",{className:D.a.chatContainer+" "+c,children:[Object(b.jsx)("div",{className:D.a.chatMain,children:i.map(((e,t)=>Object(b.jsxs)("b",{children:[e.userName,": ",Object(b.jsx)("span",{children:e.message}),Object(b.jsx)("br",{})]},t)))}),Object(b.jsxs)("form",{className:D.a.msgForm,onSubmit:e=>{e.preventDefault(),console.log(t),j.socket.emit("message",{userName:"user",message:t}),o("")},children:[Object(b.jsx)("input",{type:"text",name:"message",placeholder:"Type Message here",value:t,onChange:e=>{o(e.target.value)},required:!0}),Object(b.jsx)("button",{type:"submit",children:Object(b.jsx)(h.d,{size:25})})]}),Object(b.jsx)("div",{className:D.a.chatHandler+" "+c,children:Object(b.jsx)("span",{children:Object(b.jsx)(d.a,{size:35,onClick:()=>{r(n?D.a.closeChat:D.a.openChat),a(!n)}})})})]})},N=o(4),P=o(103),R=o(104),B=o(102),E=(o(101),o(100));var z=e=>Object(b.jsxs)(E.a,{position:e.position,style:{color:"white",width:"200px",height:"30px"},zIndexRange:[0,10],children:[Object(b.jsx)("div",{style:{height:"150px",width:"0px","border-left":"2px solid white",float:"left"}}),Object(b.jsxs)("div",{style:{"margin-left":"12px"},children:[Object(b.jsx)("span",{children:Object(b.jsx)("b",{children:e.title})}),Object(b.jsx)("br",{}),e.description,Object(b.jsx)("br",{}),e.status]})]});function T({...e}){const t=Object(s.useRef)(),{nodes:o,materials:n}=Object(B.a)("/model/DL4Y_export1.glb");return Object(b.jsxs)("group",{ref:t,...e,dispose:null,children:[Object(b.jsxs)("group",{position:[-.89,.67,.8],onPointerDown:t=>{t.stopPropagation(),e.toggleSelect("KM100_2")},children:[e.showTags&&Object(b.jsx)(z,{position:[0,1,0],title:"Reference Mirror",description:"KM100 Double Rotary Control"}),Object(b.jsx)("mesh",{geometry:o.SideMirrorMesh.geometry,material:o.SideMirrorMesh.material,children:e.selected.has("KM100_2")?Object(b.jsx)("meshStandardMaterial",{color:"#00ff00",transparent:!0,opacity:.7}):Object(b.jsx)("meshBasicMaterial",{color:"#222222",opacity:1})}),Object(b.jsx)("mesh",{geometry:o.SideMirrorMesh_1.geometry,material:o.SideMirrorMesh_1.material}),Object(b.jsx)("mesh",{geometry:o.SideMirrorMesh_2.geometry,material:n.Mirror})]}),Object(b.jsxs)("group",{position:[-.89,.86,-1.12],onPointerDown:t=>{t.stopPropagation(),e.toggleSelect("ESP32Cam_1")},children:[e.showTags&&Object(b.jsx)(z,{position:[0,1.4,0],title:"Screen",description:""}),Object(b.jsx)("mesh",{geometry:o.PlaneMesh.geometry,material:n.WhiteParts,children:e.selected.has("ESP32Cam_1")?Object(b.jsx)("meshStandardMaterial",{color:"#00ff00",transparent:!0,opacity:.7}):Object(b.jsx)("meshBasicMaterial",{color:"#eeeeee",opacity:1})}),Object(b.jsx)("mesh",{geometry:o.PlaneMesh_1.geometry,material:o.PlaneMesh_1.material})]}),Object(b.jsxs)("group",{position:[1.25,.67,.88],onPointerDown:t=>{t.stopPropagation(),e.toggleSelect("Laser")},children:[e.showTags&&Object(b.jsx)(z,{position:[0,1,0],title:"Laser",description:"green Laserpointer"}),Object(b.jsx)("mesh",{geometry:o.LaserMesh.geometry,material:o.LaserMesh.material,children:e.selected.has("Laser")?Object(b.jsx)("meshStandardMaterial",{color:"#00ff00",transparent:!0,opacity:.7}):Object(b.jsx)("meshBasicMaterial",{color:"#222222",opacity:1})}),Object(b.jsx)("mesh",{geometry:o.LaserMesh_1.geometry,material:o.LaserMesh_1.material})]}),Object(b.jsxs)("group",{position:[-.92,.49,-.14],onPointerDown:t=>{t.stopPropagation(),e.toggleSelect("ID25_1")},children:[e.showTags&&Object(b.jsx)(z,{position:[0,1.4,0],title:"Iris",description:"Controllable 15mm Iris Diaphragm"}),Object(b.jsx)("mesh",{geometry:o.ID15Mesh.geometry,material:o.ID15Mesh.material,children:e.selected.has("ID25_1")?Object(b.jsx)("meshStandardMaterial",{color:"#00ff00",transparent:!0,opacity:.7}):Object(b.jsx)("meshBasicMaterial",{color:"#222222",opacity:1})}),Object(b.jsx)("mesh",{geometry:o.ID15Mesh_1.geometry,material:o.ID15Mesh_1.material})]}),Object(b.jsx)("mesh",{geometry:o.Base.geometry,material:o.Base.material})]})}B.a.preload("/model/MI_1312.glb"),B.a.preload("/model/DL4Y_export1.glb");var W=()=>{const e=u();return e.showVirtualLayer?Object(b.jsx)(N.a,{style:{position:"absolute",background:"linear-gradient(Teal, Black)",width:"100%",height:"100%"},colorManagement:!0,softShadows:!0,camera:{position:[0,3,5],fov:40},children:Object(b.jsxs)(s.Suspense,{fallback:null,children:[Object(b.jsx)(P.a,{files:"../hdri/autoshop.hdr"}),Object(b.jsx)(R.a,{autoRotate:e.autoRotate}),Object(b.jsx)(T,{toggleSelect:e.toggleSelectedComp,selected:e.selectedComps,showTags:e.showTags})]})}):Object(b.jsx)(b.Fragment,{})},H=o(61),F=o.n(H),U=o(24),K=o.n(U),A=o(62);var V=e=>Object(b.jsx)(F.a,{handle:".draggableHandler",children:Object(b.jsxs)("div",{className:K.a.window,style:{top:e.top+"px",left:e.left+"px"},children:[Object(b.jsxs)("div",{className:K.a.windowHeader,children:[Object(b.jsx)("span",{className:"draggableHandler",style:{display:"block",width:"calc(100% - 50px)",cursor:"move",float:"left"},children:e.header}),Object(b.jsx)("div",{className:K.a.windowHeaderIcon,onClick:e.onClose,children:Object(b.jsx)(A.a,{size:20})})]}),Object(b.jsx)("div",{className:K.a.windowContent,style:{height:e.height,width:e.width,background:"url("+e.background+")"},children:e.children}),void 0!==e.footer&&Object(b.jsx)("div",{className:K.a.windowFooter,children:e.footer})]})}),J=o(35),Y=o.n(J);var G=e=>{const[t,o]=Object(s.useState)(e.sliderPos),n=u(),a=w();Object(s.useEffect)((()=>{a.socket.on("status",(t=>{console.log(t),t.component===e.component&&o(t.status[e.control])}))}),[a.socket]);return Object(b.jsx)("form",{className:Y.a.sliderCtrl,style:{top:e.top+"px",left:e.left+"px"},children:Object(b.jsxs)("div",{className:Y.a.sliderCtrl,children:[Object(b.jsx)("span",{children:t}),Object(b.jsx)("input",{type:"range",min:"0",max:"100",value:t,className:Y.a.sliderCtrl,onChange:e=>{e.preventDefault(),console.log("Setting..."),o((t=>e.target.value))},onMouseUp:s=>{s.preventDefault(),o(s.target.value),console.log("Sending Command "+s.target.value),a.socket.emit("command",{userId:"user123",componentId:e.component,command:{position:t}}),n.addLog("User set position on "+e.component+" to "+t)}})]})})};var X=e=>{const t=u();return Object(b.jsx)(V,{header:e.title+" ("+e.id+")",top:e.top,left:e.left,height:"240px",width:"250px",onClose:()=>{t.toggleSelectedComp(e.id)},children:Object(b.jsx)(G,{sliderPos:e.sliderPos,component:e.id,top:"50",left:"50"})})},Z=o(28),q=o.n(Z);var Q=e=>{const[t,o]=Object(s.useState)(e.rotation),[n,a]=Object(s.useState)(0),c=u(),r=w();Object(s.useEffect)((()=>{r.socket.on("status",(t=>{t.componentId===e.component&&o(t.status[e.control])}))}),[r.socket]);return Object(b.jsxs)("form",{className:q.a.rotaryCtrl,style:{top:e.top+"px",left:e.left+"px"},children:[Object(b.jsxs)("div",{className:q.a.rotaryCtrl,children:[Object(b.jsx)("span",{children:t}),Object(b.jsx)("input",{type:"number",min:"0",max:"100",value:n,onChange:e=>{a(e.target.value)}})]}),Object(b.jsx)("button",{onClick:t=>{t.preventDefault(),r.socket.emit("command",{userId:"user123",componentId:e.component,controlId:e.control,command:{steps:-1*n}}),c.addLog("User initiated CCW rotation on "+e.component+" / "+e.control+" by "+n+" steps.")},className:q.a.CtrlLeft,disabled:c.busyComps.has(e.component),children:Object(b.jsx)(h.a,{size:28})}),Object(b.jsx)("button",{onClick:t=>{t.preventDefault(),r.socket.emit("command",{userId:"user123",componentId:e.component,controlId:e.control,command:{steps:n}}),c.addLog("User initiated CW rotation on "+e.component+" / "+e.control+" by "+n+" steps.")},className:q.a.CtrlRight,disabled:c.busyComps.has(e.component),children:Object(b.jsx)(h.b,{size:28})})]})},$=o.p+"static/media/km100_outline.5cffd463.png";var ee=e=>{const[t,o]=Object(s.useState)(e.footer),n=u(),a=e=>{o(e)};return Object(b.jsxs)(V,{header:e.title+" ("+e.id+")",footer:t,top:e.top,left:e.left,height:"240px",width:"250px",background:$,onClose:()=>{n.toggleSelectedComp(e.id)},children:[Object(b.jsx)(Q,{rotation:e.rotationTop,component:e.id,control:"top",newStatus:a,top:"20",left:"160"}),Object(b.jsx)(Q,{rotation:e.rotationBottom,component:e.id,control:"bottom",newStatus:a,top:"50",left:"160"})]})};o(78);var te=e=>{const[t,o]=Object(s.useState)(!1),n=(u(),w());Object(s.useEffect)((()=>{n.socket.on("status",(t=>{t.componentId===e.component&&o(t.status.laser)}))}),[n.socket]);return Object(b.jsx)("button",{onClick:s=>{s.preventDefault();const a=!t;n.socket.emit("command",{userId:"user123",componentId:e.component,command:{laser:a}}),console.log("Current Laser State: "+a),o(a)},children:t?"ON":"OFF"})};var oe=e=>{const t=u();return Object(b.jsx)(V,{header:e.title+"("+e.id+")",top:e.top,left:e.left,height:"200px",width:"200px",onClose:()=>{t.toggleSelectedComp(e.id)},children:Object(b.jsx)(te,{component:e.id,top:"0",left:"0"})})};var se=e=>{const t=w(),o=u();return Object(s.useEffect)((()=>{t.socket.on("pic",(function(e){for(var t=new Uint8Array(e.buffer),o="",s=0;s<t.length;s++)o+=String.fromCharCode(t[s]);var n=window.btoa(o),a=new Image;a.onload=function(){var e=document.getElementById("ScreenCanvas");if(null!=e){e.getContext("2d").drawImage(this,0,0)}},a.src="data:image/jpg;base64,"+n}))}),[t.socket]),Object(s.useEffect)((()=>{console.log("Start Streaming."),t.socket.emit("command",{userId:"user123",componentId:e.id,command:"startStreaming"}),t.socket.emit("command",{userId:"user123",componentId:"laser_1",command:{laser:!0}})}),[]),Object(b.jsx)(V,{header:e.title+" ("+e.id+")",top:e.top,left:e.left,width:"800px",height:"600px",onClose:()=>{o.toggleSelectedComp(e.id),console.log("Stop Streaming."),t.socket.emit("command",{userId:"user123",componentId:e.id,command:"stopStreaming"}),t.socket.emit("command",{userId:"user123",componentId:"laser_1",command:{laser:!1}})},children:Object(b.jsx)("canvas",{id:"ScreenCanvas",width:"800px",height:"600px"})})};var ne=e=>Object(b.jsxs)("div",{children:[e.selected.has("KM100_2")&&Object(b.jsx)(ee,{title:"Mirror",id:"KM100_2",rotationTop:"0",rotationBottom:"0",footer:"Initializing...",top:"100",left:"100"}),e.selected.has("ID25_1")&&Object(b.jsx)(X,{title:"Iris",id:"ID25_1",sliderPos:"0",top:"150",left:"150"}),e.selected.has("ESP32Cam_1")&&Object(b.jsx)(se,{title:"Camera",id:"ESP32Cam_1",top:"100",left:"100"}),e.selected.has("Laser")&&Object(b.jsx)(oe,{title:"Laser",id:"Laser",top:"120",left:"120"})]});var ae=()=>{const e=u();return Object(b.jsx)(ne,{toggleSelect:e.toggleSelectedComp,selected:e.selectedComps})},ce=o(40),re=o.n(ce),ie=o(79),le="";const de=e=>{const t=Object(s.useRef)();return Object(s.useEffect)((()=>{e.peer.on("stream",(e=>{t.current.srcObject=e}))}),[]),Object(b.jsx)("video",{playsInline:!0,autoPlay:!0,ref:t})};var je=()=>{const e=w(),t=u(),[o,n]=Object(s.useState)([]),a=Object(s.useRef)(),c=Object(s.useRef)([]);return Object(s.useEffect)((()=>{const o={height:window.innerHeight/2,width:window.innerWidth/2};t.showWebcam&&navigator.mediaDevices.getUserMedia({video:o,audio:!0}).then((t=>{a.current.srcObject=t,e.socket.emit("roomID",(e=>{le=e})),e.socket.emit("client join room",le),e.socket.on("all users",(o=>{const s=[];o.forEach((o=>{const n=function(t,o,s){const n=new ie({initiator:!0,trickle:!1,stream:s});return n.on("signal",(s=>{e.socket.emit("sending signal",{userToSignal:t,callerID:o,signal:s})})),n}(o,e.socket.id,t);c.current.push({peerID:o,peer:n}),s.push(n)})),n(s)})),e.socket.on("user joined",(o=>{const s=function(t,o,s){const n=new ie({initiator:!1,trickle:!1,stream:s});return n.on("signal",(t=>{e.socket.emit("returning signal",{signal:t,callerID:o})})),n.signal(t),n}(o.signal,o.callerID,t);c.current.push({peerID:o.callerID,peer:s}),n((e=>[...e,s]))})),e.socket.on("receiving returned signal",(e=>{c.current.find((t=>t.peerID===e.id)).peer.signal(e.signal)}))}))}),[t.showWebcam]),t.showWebcam?Object(b.jsxs)("div",{className:re.a.webcamDiv,children:[Object(b.jsx)("video",{className:re.a.videoSt,muted:!0,ref:a,autoPlay:!0,playsInline:!0}),o.map(((e,t)=>Object(b.jsx)(de,{peer:e},t)))]}):Object(b.jsx)(b.Fragment,{})};var me=()=>Object(b.jsx)(g,{children:Object(b.jsxs)(_,{children:[Object(b.jsx)(W,{}),Object(b.jsx)(ae,{}),Object(b.jsx)(L,{}),Object(b.jsx)(je,{}),Object(b.jsx)(k,{}),Object(b.jsx)(v,{})]})});o(97);c.a.render(Object(b.jsx)(b.Fragment,{children:Object(b.jsx)(me,{})}),document.getElementById("root"))}},[[98,1,2]]]);
//# sourceMappingURL=main.ef47e80d.chunk.js.map